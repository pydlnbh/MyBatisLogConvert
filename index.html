<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>MyBatisLogConvert</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="layui/css/layui.css" media="all">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ†“</text></svg>">
  <!-- æ³¨æ„ï¼šå¦‚æœä½ ç›´æ¥å¤åˆ¶æ‰€æœ‰ä»£ç åˆ°æœ¬åœ°ï¼Œä¸Šè¿°cssè·¯å¾„éœ€è¦æ”¹æˆä½ æœ¬åœ°çš„ -->
</head>

<body>

  <fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">

    <legend style="margin-left:2px">
      <span class="layui-badge-dot"></span>
      Mybatisæ—¥å¿—è½¬æ¢
    </legend>
  </fieldset>

  <div class="layui-form-item layui-form-text">
    <label class="layui-form-label"><a style="font-size: 20px">æ—¥å¿—å†…å®¹</a></label>
    <div class="layui-input-block">
      <textarea style="height: 300px;" placeholder="åœ¨æ­¤å¤„ç²˜è´´æ—¥å¿—å†…å®¹" id="log" name="log" class="layui-textarea"></textarea>
    </div>
  </div>

  <div style="margin-left: 110px;">

    <button type="button" class="layui-btn layui-btn-warm" onclick="transLog()">è½¬æ¢å¹¶å¤åˆ¶</button>
  </div>

  <br>
  <br>
  <div class="layui-form-item layui-form-text">
    <label class="layui-form-label"><a style="font-size: 20px">SQL</a></label>
    <div class="layui-input-block">
      <div style="border:red; solid 2px;" id="sql"></div>
    </div>







    <script src="layui/layui.all.js" charset="utf-8"></script>
    <!-- æ³¨æ„ï¼šå¦‚æœä½ ç›´æ¥å¤åˆ¶æ‰€æœ‰ä»£ç åˆ°æœ¬åœ°ï¼Œä¸Šè¿°jsè·¯å¾„éœ€è¦æ”¹æˆä½ æœ¬åœ°çš„ -->
    <script>

      function transLog() {

        var textVa = document.getElementById("log").value;
        // è·å–å¸¦é—®å·çš„SQLè¯­å¥
        var statementStartIndex = textVa.indexOf('Preparing: ');
        var statementEndIndex = textVa.length - 1;
        for (var i = statementStartIndex; i < textVa.length; i++) {
          if (textVa[i] == "\n") {
            statementEndIndex = i;
            break;
          }
        }
        var statementStr = textVa.substring(statementStartIndex + "Preparing: ".length, statementEndIndex);
        //è·å–å‚æ•°
        var parametersStartIndex = textVa.indexOf('Parameters: ');
        var parametersEndIndex = textVa.length;
        for (var i = parametersStartIndex; i < textVa.length; i++) {
          if (textVa[i] == "\n") {
            parametersEndIndex = i;
            break;
          } else {
            // console.log(textVa[i]);
          }
        }
        var parametersStr = textVa.substring(parametersStartIndex + "Parameters: ".length, parametersEndIndex);

        // å‚æ•°åˆ—è¡¨
        var parametersStrArr = parametersStr.split(",");

        for (var i = 0; i < parametersStrArr.length; i++) {
          tempStr = parametersStrArr[i].substring(0, parametersStrArr[i].indexOf("("));
          // ä¸å«"("æ˜¯null
          if (tempStr == '') {
            tempStr = "null";
          }
          // å¦‚æœæ•°æ®ä¸­å¸¦æ‹¬å·éœ€è¦åˆ¤æ–­å‚æ•°ç±»å‹
          typeStr = parametersStrArr[i].substring(parametersStrArr[i].indexOf("(") + 1, parametersStrArr[i].indexOf(")"));
          if (typeStr == "String" || typeStr == "Timestamp") {
            statementStr = statementStr.replace("?", "'" + tempStr.trim() + "'");
          } else {
            statementStr = statementStr.replace("?", tempStr.trim());
          }
        }

        document.getElementById("sql").innerHTML = statementStr;
        copyToClip(statementStr);
      }

      //å¤åˆ¶åˆ°å‰ªè´´æ¿
      function copyToClip(content) {
        var aux = document.createElement("input");
        aux.setAttribute("value", content);
        document.body.appendChild(aux);
        aux.select();
        document.execCommand("copy");
        document.body.removeChild(aux);

        if ("" != content) {
          layer.msg("å¤åˆ¶æˆåŠŸï¼Œç›´æ¥ç²˜è´´å³å¯");
        } else {
          layer.alert("è½¬æ¢å¤±è´¥");
        }


      }

    </script>

</body>

</html>